<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8"/>
	<title>mystory_recorder</title>
	<meta name="description" content="" />
	<link rel="stylesheet" href="http://mystory.dev.jesus.net/wp-content/themes/mystory/static/css/style.css" media="all" />
	<link rel="stylesheet" href="http://mystory.dev.jesus.net/wp-content/themes/mystory/static/css/user.css" media="all" />	
	<script src="http://ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script src="http://mystory.dev.jesus.net/wp-content/themes/mystory/static/js/modernizr.js"></script>
	
	
	<script>
  function onCreationComplete(e) {
    console.log("onCreationComplete",e);
  };
   function onPropertyChange(e) {
          console.log("onPropertyChange",e);
    };
    
		(function( $ ) {
			
			$.fn.videoIOControlsDefaults = {};
			var init = function(movie, options) {
				console.log("Juhuu, the flash is ready!!!!");
				$.each(options, function(property, value){
					if(property !== 'defaults') {
						movie.setProperty(property, value);
					} else {
						movie.defaults = value;
					}
				});
		    console.log("setting parameters");
       
 
			};
      var initControls = function(movie) {
        console.log("initControls");
        $("button[data-videoio]").each(function(index){
          var el = $(this);
          var type = el.data("videoio");
          movie.controls = {};
          movie.controls[type] = el;
          switch(type) {
            case "play":
              el.click(function(e){
                console.log("play", movie.defaults.baseUrl+"?play="+movie.defaults.filename);
                movie.setProperty("src",movie.defaults.baseUrl+"?play="+movie.defaults.filename);
              });
              break;
            case "record":
              el.click(function(e){
                console.log("record", movie.defaults.baseUrl+"?publish="+movie.defaults.filename+"&record=true");
                movie.setProperty("src",movie.defaults.baseUrl+"?publish="+movie.defaults.filename+"&record=true");
              });
              break;
            case "stop":
              el.click(function(e){
                console.log("stop", null);
                movie.setProperty("src",null);
              });
              break;
          };
          console.log("found type: "+type);
        });
      };
		  $.fn.videoIOControls = function(options) {
				if(options===undefined) {
					options = {};
				}
			    console.log("Welcome to the VideoIO Controls");
			    // ok, lets find the configuration
			    this.inputElements = $("input [data-property]");
			    this.actionElements = $("button [data-videoio]");
			    this.outputElements = $(".property [data-property]");
			    // lets wait until the object is ready
			    var movie = this[0];
			    var checkForReadyness = setInterval(function(){
            if(typeof movie.setProperty === 'function') {
              clearInterval(checkForReadyness);
              console.log("READY");
              init(movie, options);
              initControls(movie);
            } else {
              console.log("not ready yet");
            }
          },100);
        };
        
        
		    // 
		})( jQuery );
	
		var onFlashEmbeddingComplete = function(event) {
      var filename = "test-red5-" +(new Date()).getTime();
			$(event.ref).videoIOControls({
				mirrored: true,
				cameraQuality: 90,
				cameraDimension: "720x480",
				cameraFPS: 30,
				live: true,
				controls: true,
				defaults: {
					baseUrl:"rtmp://kis2.bossdev.org/record", 
          filename: filename
				}
			});
      return true;
		}
		
		var flashvars = {
			
		};
		var params = {
			allowFullscreen: "true",
			allowScriptAccess: "always",
			bgcolor: "#000000",
			quality: "high",
		};
		var attributes = {
			id:"mystoryrecorder"
		};
		swfobject.embedSWF(
			"VideoIO11.swf", 
			"mystoryrecorder_container", "620px", "410px", "10.0.0", 
			"expressInstall.swf", 
			flashvars, params, attributes, onFlashEmbeddingComplete);
      
function onPropertyChange(event) {
    var obj = document.getElementById(event.property);
    if (obj) {
        if (typeof(event.newValue) == "boolean")
            obj.checked = event.newValue;
        else if (typeof(event.newValue) == "number")
            obj.value = event.newValue.toString();
        else 
            obj.value = event.newValue != null ? event.newValue : "";
    }
    else {
        log(event.objectID + "." + event.property + "=" + event.oldValue + "=>" + event.newValue);
    }
}

function onCallback(event) {
    log("onCallback() method=" + event.method + ", args=" + event.args);
}

function onPostingNotify(event) {
    log("onPostingNotify() user=" + event.user + ", text=" + event.text);
}

function onReceiveData(event) {
    log("onReceiveData() data=" + event.data);
}

function onShowingSettings(event) {
	log("onShowingSettings() showing=" + event.showing);
}

	</script>
	<style>
		html, body {  }
		body { }
    .overlay {position:relative;background:white;}
    .columns {position:relative}
	</style>
</head>
<body>
  <div class="wrapper">
    <div class="overlay">
      <h1>Record your video!</h1>
      <p>Would you like to have some help on recording your video? We could give you so small sweet how to's! Just click here!</p>
      <div class="columns">
        <div id="flash_recorder" class="main-column left">
          
          <div id="mystoryrecorder_container">
            <h1>Oh no, you have no Flash :-(</h1>
            <p><a href="http://www.adobe.com/go/getflashplayer">Get Adobe Flash player</a></p>
          </div>
          
          <ul class="commands">
            <li><button data-videoio="record">Record</button></li>
            <li><button data-videoio="play">Play</button></li>
            <li><button data-videoio="pause">Pause</button></li>
            <li><button data-videoio="backward">&lt;&lt;</button></li>
            <li><button data-videoio="forward">&gt;&gt;</button></li>
            <li><button data-videoio="stop">Stop</button></li>
            <li><button data-videoio="delete">Delete</button></li>
            <li><button data-videoio="save">Save</button></li>
          </ul>
        </div>
        <div id="timeline" class="side ">
          <ul class="timeline">
            <li>20 sec</li>
            <li>40 sec</li>
            <li>1 min</li>
            <li>1 min 20 sec</li>
            <li>1 min 40 sec</li>
            <li>2 min</li>
            <li>2 min 20 sec</li>
            <li>2 min 40 sec</li>
            <li>3 min</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
